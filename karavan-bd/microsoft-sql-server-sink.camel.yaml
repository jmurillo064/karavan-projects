- route:
    id: ruta-conexion-db
    nodePrefixId: ruta-conexion-db
    from:
      id: from-15b2
      uri: timer
      parameters:
        delay: "10000"
        timerName: timer-test-bd
        period: "120000"
      steps:
        - setBody:
            id: setBody-4734
            expression:
              simple:
                id: simple-c285
                expression: "{\"contenido\": \"Mensaje de prueba desde Karavan\"}"
        - to:
            id: sql-server-sink
            disabled: true
            uri: kamelet:sqlserver-sink
            parameters:
              password: "{{sql.password}}"
              username: "{{sql.username}}"
              serverPort: "{{sql.port}}"
              serverName: "{{sql.server}}"
              databaseName: "{{sql.database}}"
              query: INSERT INTO contenido (contenido) VALUES (:#contenido)
        - log:
            id: log-69fb
            message: ${body}
        - to:
            id: to-0667
            disabled: true
            uri: kamelet:sqlserver-sink
            parameters:
              serverName: "{{sql.server}}"
              serverPort: "{{sql.port}}"
              username: "{{sql.username}}"
              password: "{{sql.password}}"
              databaseName: "{{sql.database}}"
              query: >-
                SELECT TOP 5 id, contenido, fecha_procesamiento FROM contenido
                ORDER BY id DESC
        - to:
            id: to-51f3
            disabled: true
            uri: sql
            parameters:
              query: >-
                SELECT TOP 5 id, contenido, fecha_procesamiento FROM contenido
                ORDER BY id DESC
              dataSource: "#myDataSource"
        - step:
            id: step-3dad
            steps:
              - setBody:
                  id: setBody-47be
                  expression:
                    simple:
                      id: simple-12c8
                      expression: >-
                        SELECT id, contenido, fecha_procesamiento FROM contenido
                        WHERE id = 55 ORDER BY id DESC
              - setHeader:
                  id: setHeader-bb11
                  name: CamelJdbcParameters
                  expression:
                    simple:
                      id: simple-3937
                      expression: "5"
              - to:
                  id: to-e7dc
                  uri: jdbc
                  parameters:
                    dataSourceName: myDataSource
              - choice:
                  id: choice-95dd
                  when:
                    - id: when-9959
                      expression:
                        simple:
                          id: simple-06c1
                          expression: ${body.size()} > 0
                      steps:
                        - split:
                            id: split-5624
                            expression:
                              simple:
                                id: simple-31d2
                                expression: ${body}
                            steps:
                              - log:
                                  id: log-7786
                                  message: >-
                                    Registro ID: ${body[id]} - Contenido:
                                    ${body[contenido]}
                                  loggingLevel: INFO
                  otherwise:
                    id: otherwise-1d42
                    steps:
                      - log:
                          id: log-a3eb
                          message: No se encontraron registros
                          loggingLevel: WARN
        - log:
            id: log-cdc2
            message: ${body}
